# Koopman-for-Dynamic-Planar-Manipulation
This repository includes a porition of the code for the paper	Koopman Global Linearization of Contact-Rich Dynamics for Locomotion and Manipulation.

## Abstract
Controlling robots that dynamically engage in contact with their environment is a pressing challenge. Whether a legged robot making-and-breaking contact with a floor, or a manipulator grasping objects, contact is everywhere. Unfortunately, the switching of dynamics at contact boundaries makes control difficult. Predictive controllers face non-convex optimization problems when contact is involved. Here, we overcome this difficulty by applying Koopman operators to subsume the segmented dynamics due to contact changes into a unified, globally-linear model in an embedding space. We show that viscoelastic contact at robot-environment interactions underpins the use of Koopman operators without approximation to control inputs. This methodology enables the convex Model Predictive Control of a legged robot, and the real-time control of a manipulator engaged in dynamic pushing. Here, we show that our method allows robots to discover elaborate control strategies in real-time over time horizons with multiple contact changes, and the method is applicable to broad fields beyond robotics. 

## Code Structure
The code for the manipulation experiments are structured as follows:
1. A Control-Coherent Koopman (CCK) implementation for a square-slider system.
2. A CCK implementation for a circle-slider system. This folder includes a bilinear Koopman baseline for comparisons.
3. A `spec-file` that describes the conda environment that was used to run the experiments, for reproducing the results.

A file named `planar_pusher.py` contains the nonlinear dynamic model used to simulate the pusher-slider systems of interest, while a pair of data generation files `GenerateData_main.py` and `GenerateData_subset.py` are used to create training data. The deep Koopman networks (DKNs) used in this work are produced within specified `nn_*` folders. The models used to produce the results in the paper are saved in this repository, as are a selection of model checkpoints.

## How to Use
If you are interested in experimenting with the CCK Model Predictive Control (MPC) controller in this work, then implementations of simulated pushing scenarios can be found in the files `kmpc_01dt_*.py`. These files can be run within a python environment and will use the saved Koopman models to control a system defined by the nonlinear dynamics in `planar_pusher.py`. The initial state and target trajectory of the system can be varied by changing the relevant variables in the script (specifically, the `init_state` and `conduit_traj` arrays).

If you are interested in reproducing the Koopman modeling results, then data can be generated by calling the `GenerateData_subset.py` scripts. The `-seed` and `-duration` flags can be used to vary the amount of training data produced. A series of data files will be created, which will need to be merged into a single data array for training. Once a dataset is created, the `training.py` script within the neural network folder `nn_*` will build the autonomous DKN model. Note that the training process is non-deterministic, so the resulting model will almost certainly differ from that saved in the repository.

## If you wish to reference this work
Please include a citation to the publication associated with this work at:
TO-BE-ADDED
